# Schéma du Workflow Self-Healing Infrastructure V3

## Diagramme de Flux Principal

```
                                    ┌─────────────────┐
                                    │   UPTIME KUMA   │
                                    │   (Monitoring)  │
                                    └────────┬────────┘
                                             │
                                             │ Alert Webhook
                                             ▼
┌────────────────────────────────────────────────────────────────────────────┐
│                           MAIN SUPERVISOR (N8N)                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────────────────┐ │
│  │ Webhook  │───▶│Normalize │───▶│ RAG Check│───▶│    Route Decision    │ │
│  │ Trigger  │    │ Payload  │    │ (Qdrant) │    │ (N0/N1/N2 Selection) │ │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┬───────────┘ │
└──────────────────────────────────────────────────────────────┼─────────────┘
                                                               │
                         ┌─────────────────┬───────────────────┼─────────────┐
                         │                 │                   │             │
                         ▼                 ▼                   ▼             ▼
                   ┌──────────┐     ┌──────────┐        ┌──────────┐  ┌──────────┐
                   │ N0: RAG  │     │N1: LOCAL │        │N2: CLOUD │  │N3: OPUS  │
                   │ (Known)  │     │CONSENSUS │        │ (Sonnet) │  │(Architect│
                   └────┬─────┘     └────┬─────┘        └────┬─────┘  └────┬─────┘
                        │                │                   │             │
                        │                ▼                   │             │
                        │    ┌───────────────────────┐       │             │
                        │    │     AURACORE API      │       │             │
                        │    │   ┌───────────────┐   │       │             │
                        │    │   │     QWEN      │   │       │             │
                        │    │   │ DIAGNOSTICIAN │   │       │             │
                        │    │   │               │   │       │             │
                        │    │   │ ┌───────────┐ │   │       │             │
                        │    │   │ │• Analyze  │ │   │       │             │
                        │    │   │ │• Diagnose │ │   │       │             │
                        │    │   │ │• Propose  │ │   │       │             │
                        │    │   │ └───────────┘ │   │       │             │
                        │    │   └───────┬───────┘   │       │             │
                        │    │           │           │       │             │
                        │    │           ▼           │       │             │
                        │    │   ┌───────────────┐   │       │             │
                        │    │   │    PHI-3      │   │       │             │
                        │    │   │   VALIDATOR   │   │       │             │
                        │    │   │               │   │       │             │
                        │    │   │ ┌───────────┐ │   │       │             │
                        │    │   │ │• Challenge│ │   │       │             │
                        │    │   │ │• Validate │ │   │       │             │
                        │    │   │ │• Score    │ │   │       │             │
                        │    │   │ └───────────┘ │   │       │             │
                        │    │   └───────┬───────┘   │       │             │
                        │    │           │           │       │             │
                        │    │           ▼           │       │             │
                        │    │   ┌───────────────┐   │       │             │
                        │    │   │   CONSENSUS   │   │       │             │
                        │    │   │    ENGINE     │   │       │             │
                        │    │   └───────┬───────┘   │       │             │
                        │    └───────────┼───────────┘       │             │
                        │                │                   │             │
                        ▼                ▼                   ▼             ▼
                   ┌─────────────────────────────────────────────────────────┐
                   │                    DECISION HUB                         │
                   │  ┌────────────┬────────────┬────────────┬────────────┐ │
                   │  │AUTO_EXECUTE│EXEC_W_LOG │HUMAN_REVIEW│ESCALATE_N2 │ │
                   │  └─────┬──────┴─────┬──────┴─────┬──────┴─────┬──────┘ │
                   └────────┼────────────┼────────────┼────────────┼────────┘
                            │            │            │            │
                            └────────────┼────────────┘            │
                                         │                         │
                                         ▼                         │
┌────────────────────────────────────────────────────────────────┐ │
│                      ACTION EXECUTOR (N8N)                      │ │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐ │ │
│  │ Validate │───▶│ Execute  │───▶│  Check   │───▶│  Report  │ │ │
│  │Whitelist │    │  Action  │    │  Result  │    │  Status  │ │ │
│  └──────────┘    └──────────┘    └──────────┘    └──────────┘ │ │
└──────────────────────────────────────────────────────────────────┘ │
                            │                                       │
                            │                                       │
                            ▼                                       ▼
┌────────────────────────────────────────────────────────────────────────────┐
│                      NOTIFICATION MANAGER (N8N)                             │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐                 │
│  │   SUCCESS    │    │   FAILURE    │    │  ESCALATION  │                 │
│  │    EMAIL     │    │    EMAIL     │    │    EMAIL     │                 │
│  │              │    │              │    │  (Approval   │                 │
│  │ ✓ Resolved   │    │ ✗ N1 Failed  │    │    Links)    │                 │
│  └──────────────┘    └──────────────┘    └──────────────┘                 │
└────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
                              ┌──────────────────┐
                              │     QDRANT       │
                              │  (RAG Storage)   │
                              │                  │
                              │ • Store incident │
                              │ • Learn pattern  │
                              │ • Future N0      │
                              └──────────────────┘
```

## Légende

| Symbole | Signification |
|---------|---------------|
| ───▶ | Flux de données |
| │ | Connexion |
| ┌─┐ | Composant/Node |
| N0-N3 | Niveau de résolution |

## Temps de Traitement Typiques

| Niveau | Composants | Temps |
|--------|------------|-------|
| N0 | RAG lookup | < 5s |
| N1 | Qwen + Phi-3 + Consensus | 60-90s |
| N2 | Claude Sonnet | 30-60s |
| N3 | Claude Opus + Human | Variable |
